# NeckRange AI（ネックレンジAI）

首の左右への傾き（側屈）の角度を測定し、柔軟性や姿勢のバランスを簡易診断するWebアプリケーション

## 🎯 プロジェクト概要

**NeckRange AI**は、画像認識技術（MediaPipe Pose）を用いて、ユーザーの首の可動域を測定し、姿勢のバランスを診断するサービスです。

### ターゲットユーザー
- デスクワーカー
- 整体・フィットネス事業者
- 自身の姿勢に関心がある一般ユーザー

### 主な機能
- 📸 3枚の画像撮影（正面、右側屈、左側屈）
- 🎯 AIによる骨格キーポイント検出
- 📐 首の傾き角度の精密測定
- ⚠️ 代償動作（肩の動き）の自動検知
- 📊 左右差の診断とビジュアルフィードバック

## 🏗️ 技術スタック

### フロントエンド
- **React** 18.x
- **TypeScript**
- **MediaPipe Pose** (ブラウザ上でAI処理)
- **Canvas API** (ビジュアルフィードバック)
- **Tailwind CSS** (スタイリング)

### バックエンド（オプション）
- **Python** 3.9+
- **FastAPI** (REST API)
- **OpenCV** (画像処理)

## 📋 機能要件

### 1. 画像入力機能
- 正面静止画像（基準）のアップロード/撮影
- 右側屈画像のアップロード/撮影
- 左側屈画像のアップロード/撮影
- 撮影ガイドラインのオーバーレイ表示

### 2. AI解析機能
- MediaPipe Poseによる33個のキーポイント検出
- 主要ランドマーク：鼻、左右の肩、左右の耳、左右の目

### 3. 代償動作検知
- 両肩を結ぶ線の角度計算
- 許容範囲：±5°以内
- 範囲外の場合は警告メッセージ表示

### 4. 角度測定アルゴリズム

#### 肩の水平チェック
```
α = arctan((y_sl - y_sr) / (x_sl - x_sr)) × 180/π
判定: |α| > 5° の場合、エラー
```

#### 首の傾き角度測定
```
両肩の中点M = ((x_sr + x_sl)/2, (y_sr + y_sl)/2)
θ = arctan((x_n - x_m) / (y_m - y_n)) × 180/π
```

### 5. 診断機能
- 測定角度の表示（右側屈・左側屈）
- 正常値との比較（成人平均：45°〜50°）
- 「硬い」「普通」「柔らかい」の評価
- 左右差の判定とフィードバック

## 🚀 セットアップ

### 前提条件
- Node.js 18.x以上
- npm または yarn

### インストール

```bash
# 依存関係のインストール
npm install

# 開発サーバーの起動
npm run dev

# ビルド
npm run build

# プレビュー
npm run preview
```

## 📁 プロジェクト構造

```
webapp/
├── public/              # 静的ファイル
├── src/
│   ├── components/      # Reactコンポーネント
│   │   ├── Camera.tsx          # カメラ撮影コンポーネント
│   │   ├── ImageUpload.tsx     # 画像アップロードUI
│   │   ├── PoseDetection.tsx   # 姿勢検出処理
│   │   ├── AngleCalculator.tsx # 角度計算ロジック
│   │   └── ResultDisplay.tsx   # 診断結果表示
│   ├── hooks/           # カスタムフック
│   ├── utils/           # ユーティリティ関数
│   │   ├── poseUtils.ts        # 姿勢解析関数
│   │   ├── angleUtils.ts       # 角度計算関数
│   │   └── validationUtils.ts  # バリデーション関数
│   ├── types/           # TypeScript型定義
│   ├── App.tsx          # メインアプリケーション
│   └── main.tsx         # エントリーポイント
├── package.json
├── tsconfig.json
├── vite.config.ts
└── README.md
```

## 🔒 プライバシーとセキュリティ

- アップロードされた画像はブラウザ内でのみ処理
- サーバーへの画像送信は行わない（クライアント完結）
- 画像データは解析後にメモリから自動削除
- 個人情報の保存なし

## 📐 数式定義

### 座標定義
- 右肩: S_R(x_sr, y_sr)
- 左肩: S_L(x_sl, y_sl)
- 鼻: N(x_n, y_n)
- 頭頂: H(x_h, y_h)

### ステップ1: 肩の水平チェック
```
α = arctan((y_sl - y_sr) / (x_sl - x_sr)) × 180/π
判定条件: |α| > Threshold (5°) の場合、エラー
```

### ステップ2: 首の傾き角度測定
```
両肩の中点M = ((x_sr + x_sl)/2, (y_sr + y_sl)/2)
θ = arctan((x_n - x_m) / (y_m - y_n)) × 180/π
```

## 🎨 UI/UXデザイン

- 直感的な3ステップフロー
- リアルタイムフィードバック
- わかりやすいエラーメッセージ
- レスポンシブデザイン（PC/スマートフォン対応）

## 📊 診断基準

### 可動域の評価
- **硬い**: 30°未満
- **やや硬い**: 30°〜40°
- **普通**: 40°〜50°
- **柔軟**: 50°以上

### 左右差の評価
- **正常**: 差が5°以内
- **軽度の左右差**: 差が5°〜10°
- **中等度の左右差**: 差が10°〜15°
- **顕著な左右差**: 差が15°以上

## 🔧 開発者向け情報

### MediaPipe Poseのランドマーク
- 0: 鼻 (Nose)
- 2: 左目内側 (Left Eye Inner)
- 5: 右目内側 (Right Eye Inner)
- 7: 左耳 (Left Ear)
- 8: 右耳 (Right Ear)
- 11: 左肩 (Left Shoulder)
- 12: 右肩 (Right Shoulder)

### 角度計算の注意点
- 画像座標系はY軸が下向き（通常の数学座標系と逆）
- atan2関数を使用して象限を正しく判定
- ラジアンから度への変換を忘れずに

## 📝 ライセンス

MIT License

## 👥 コントリビューション

プルリクエスト歓迎！

## 📞 サポート

問題が発生した場合は、GitHubのIssuesセクションで報告してください。
